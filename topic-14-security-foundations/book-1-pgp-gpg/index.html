 <!DOCTYPE html>
 <html>
   <head>

     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1">

     

     <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>

     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.css" type="text/css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-light.min.css" rel="stylesheet" />

     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.address/1.6/jquery.address.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/java.min.js"></script>
     <script>hljs.initHighlightingOnLoad();</script>

     

     <style>
       

body 
{
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
}

figcaption
{
  margin-bottom: 20px;
}

.vertical-align
{
  display: flex;
  align-items: center;
}

.ui.segment.pushable
{
  margin: 0;
  padding: 1rem 0;
  overflow: visible;
}



     </style>

   </head>

  <body>
    

<style>
  

code
{
  font-family: "Monaco";
  font-size: 110%;
}

img
{
  padding:1px;
  border:1px solid black;
}

h1
{
  font-style:italic;
  font-size:130%;
  border-bottom:thin solid black;
}

h2
{
  font-size:110%;
  border-bottom: thin solid black;
}

h3
{
  font-size:100%;
  border-bottom: thin solid black;
}

body
{
  overflow-y: scroll;
}

.pushable > .pusher
{
  padding-bottom: 1.5rem;
}

.ui.segment.pushable
{
  margin: 0;
  padding: 1rem 0;
  overflow: visible;
}



</style>

<div class="ui fixed top pointing inverted stackable menu labmenu">
  <header class="header item">
    <i id="toc" class="sitemap icon"></i>
    <a href="../index.html">
      14: Foundations of security
    </a>
  </header>
  <div class="right tab-menu menu">
    
    <a class="item" data-tab="Lab-13 GPG">
      Lab-13 GPG
    </a>
    
    <a class="item" data-tab="1-Intro">
      1-Intro
    </a>
    
    <a class="item" data-tab="2">
      2
    </a>
    
    <a class="item" data-tab="3">
      3
    </a>
    
    <a class="item" data-tab="4">
      4
    </a>
    
    <a class="item" data-tab="5">
      5
    </a>
    
    <a class="item" data-tab="6">
      6
    </a>
    
    <a class="item" data-tab="7">
      7
    </a>
    
    <a class="item" data-tab="8">
      8
    </a>
    
    <div class="item">
      
    </div>
  </div>
</div>

<div class="ui segment pushable">
  <div class="ui inverted labeled icon left inline vertical sidebar menu">
    <br><br>
    
      
        <a class="item" href="../../topic-02-js-review/book-1-javascript-intro/index.html">
          Lab-2.1 JS Intro
        </a>
      
    
      
        <a class="item" href="../../topic-02-js-review/book-2-javascript-fundamentals/index.html">
          Lab-2.2 JS Basics
        </a>
      
    
      
        <a class="item" href="../../topic-03-jquery+dom/book-3-jquery/index.html">
          Lab-3 JQuery
        </a>
      
    
      
        <a class="item" href="../../topic-04-ajax+apis/book-1-ajax-1/index.html">
          Lab-4.1 Github API
        </a>
      
    
      
        <a class="item" href="../../topic-04-ajax+apis/book-2-ajax-2/index.html">
          Lab-4.2-FoureSquare API
        </a>
      
    
      
        <a class="item" href="../../topic-05-applications/book-applications/index.html">
          Lab-5 Applications
        </a>
      
    
      
        <a class="item" href="../../topic-06-views/book-views/index.html">
          Lab-6 Views
        </a>
      
    
      
        <a class="item" href="../../topic-07-sessions/book-sessions/index.html">
          Lab-7 Sessions
        </a>
      
    
      
        <a class="item" href="../../topic-08-models/book-models/index.html">
          Lab-8 Models
        </a>
      
    
      
        <a class="item" href="../../topic-09-validation/book-validation/index.html">
          Lab-9 Validation
        </a>
      
    
      
        <a class="item" href="../../topic-10-deployment/book-deployment/index.html">
          Lab-10 Deployment
        </a>
      
    
      
        <a class="item" href="../../topic-11-seeding/book-seeding/index.html">
          Lab-11 Seeding
        </a>
      
    
      
        <a class="item" href="../../topic-12-api/book-api/index.html">
          Lab-12 Apis
        </a>
      
    
      
        <a class="active item" href="../../topic-13-security-introduction/book-1-pgp-gpg/index.html">
          Lab-13 GPG
        </a>
      
    
      
        <a class="item" href="../../topic-14-security-foundations/book-1-openssl/index.html">
          Lab-14 OpenSSL and Certificates
        </a>
      
    
      
        <a class="active item" href="../../topic-14-security-foundations/book-1-pgp-gpg/index.html">
          Lab-13 GPG
        </a>
      
    
  </div>
  <div class="pusher" tabindex="-1">
    <div class="ui basic segment" id="labchat">
      <br>
      
      <div  class="ui tab segment lab" data-tab="Lab-13 GPG">
        <h1>Objectives</h1>
<p>Use a cryptographic application to manage keys and carry out encryption and authentication exercises</p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="1-Intro">
        <h1>Pretty Good Privacy (PGP) / Gnu Privacy Guard (GPG)</h1>
<p>PGP/GPG provides a confidentiality and authentication service that can be used for storage and messaging applications. In this practical exercise, we will use some of the basic features of an application to do the following:</p>
<ul>
<li>Generate a public/private key pair for yourself</li>
<li>Share your public key with others</li>
<li>Import public keys belonging to others</li>
<li>Determine whether you trust the keys of others</li>
<li>Exchange messages and files with each other that are<ul>
<li>Encrypted</li>
<li>Signed</li>
<li>Both encrypted and signed</li>
</ul>
</li>
<li>Decrypt and/or verify authenticity of received messages and files</li>
</ul>
<p>The main attraction of PGP/GPG-based public key cryptography tools is that each user is responsible for the management and storage of their own keys without the need to trust a third party.  This decentralised approach is <a href="https://theintercept.com/2014/10/28/smuggling-snowden-secrets/">attractive to people with serious privacy concerns</a>, although <a href="https://www.usenix.org/conference/8th-usenix-security-symposium/why-johnny-cant-encrypt-usability-evaluation-pgp-50">this need for user involvement arguably makes the technology unsuitable as a general encryption tool for the public</a>.</p>
<p>Either way, playing with PGP/GPG is a nice way to learn about public key cryptography and its benefits and limitations. </p>
<h2>PGP background &amp; versions</h2>
<p>PGP was originally designed as an e-mail security application back in 1991, and is largely the product of a single person, Phil Zimmermann.  He has quite a colourful past – see <a href="http://www.philzimmermann.com">his personal website</a>.</p>
<p>PGP has been developed commercially over the years and integrated into various security products for encrypting and signing of email, instant messages, files, devices and whole disks as well as managing keys, enabling virtual private networks (VPNs), and so on. PGP technology has been owned by various companies, including Network Associates, PGP Corporation and, currently, Symantec.</p>
<p>In parallel with this, since the late 1990s, Gnu Privacy Guard (GnuPG or GPG) and a range of other interoperable tools with similar functionality have been developed and maintained.  This compatibility has been made possible by the <a href="https://tools.ietf.org/html/rfc4880">OpenPGP specification (RFC 4880)</a> which defines standard formats for storing keys and encrypted/signed data.</p>
<h2>Key Management</h2>
<p>One of the most interesting aspects of PGP/GPG is its distributed approach to key management. There are no key certification authorities; PGP/GPG instead supports a “web of trust”. Every user generates and distributes his/her own public key. Users sign each other’s public keys, creating an interconnected community of PGP/GPG users.</p>
<p>For example, Alice might physically give her public key to Bob. Bob knows Alice personally, so he signs her public key. He then gives the signed key back to her and keeps a copy for himself. When Alice wants to communicate with Carol, Alice sends Carol a copy of the key Bob signed. Now if Carol already has Bob’s public key (she got it some other time) and trusts Bob to certify other people’s keys, she then verifies Bob’s signature on Alice’s key and accepts it as valid. Bob has (indirectly) introduced Alice to Carol.</p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="2">
        <h2>1. Installation</h2>
<p>If using Windows, before starting, change your settings to <a href="http://kb.winzip.com/kb/entry/26/">make file extensions viewable</a>. This is not essential, but makes it easier to distinguish between files that are encrypted and those that are not.</p>
<p>Locate and install a fresh version of GPG (or PGP) for your operating system of choice.  Recommendations:</p>
<ul>
<li>Windows: <a href="https://www.gpg4win.org/download.html">Gpg4win</a></li>
<li>MacOS: <a href="https://gpgtools.org/">GPG Suite</a>  -or- gpg / gpg2 terminal commands</li>
<li>Linux: Kleopatra (on Ubuntu: &#39;sudo apt install kleopatra&#39;) -or- gpg / gpg2 terminal commands</li>
</ul>
<p>The remainder of these lab instructions assume that you are working with <a href="https://www.gpg4win.org/download.html">Gpg4win</a> on Windows, although they are fairly easily adaptable to MacOS or Linux.  Step 6 explains how to do all the steps of this lab at the command line.</p>
<p>Install Gpg4win by double-clicking on the downloaded file (gpg4win-3.0.0.exe).  When asked to choose components, ensure that <em>Kleopatra</em> and <em>GpgEX</em> are checked. Uncheck <em>GpgOL</em>. 
<img src="img/gpg4win-components.png" alt="Gpg4win components"></p>
<p>You may choose the default install location at the next step.</p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="3">
        <h2>2. Key Generation, Management &amp; Exchange</h2>
<ul>
<li><p>Launch the Kleopatra application. This is the GUI for GPG. 
<img src="img/kleopatra-start.png" alt="Kleopatra"></p>
</li>
<li><p>Select <em>New Key Pair</em>. Enter your name and email address. Use your real name (email address doesn’t really matter). If you click <em>Advanced Settings</em> within this dialogue, you can choose algorithms and key settings but the defaults (2048-bit RSA) are fine.</p>
</li>
<li><p>You are asked to create a passphrase that will be used to protect storage of your private key (make a note of this passphrase to make sure you remember it).</p>
</li>
<li><p>You can see your new  key (certificate) in the main pane of Kleopatra.
<img src="img/kleopatra-new-key.png" alt="Newly created key certificate"></p>
</li>
<li><p>Select your key certificate and save a copy of the public key to disk using right-click menu (Export...). Save this to a file called <em>yourfirstname-lastname.asc</em> for inclusion in your Moodle upload (details at end).</p>
</li>
<li><p>Select your key certificate again and save a copy of the <em>private</em> key to disk using right-click menu (Export Secret Keys...).  Name the file <em>yourfirstname-lastname-private.asc</em>. (Do not upload this to Moodle or give to anyone else as it is private to you). This file should be kept securely as a backup.</p>
</li>
<li><p>Share the first (public key) certificate file with your classmate(s).</p>
</li>
<li><p>Import the public key certificate(s) provided to you by your classmate(s). With Kleopatra you can just drag the file into the main pane.  You will be prompted to certify that this is <em>really</em> their key - one way to check this is to verify the key certificate&#39;s cryptographic hash with the key owner.  In the next step it is sufficient to certify for yourself for now.  You are <em>signing</em> the key certificate being imported to declare your belief that it genuinely belongs to the named owner.  As the signing process requires your own private key, you are prompted for your passphrase. </p>
</li>
<li><p>Have a look at the public keys exchanged.  Find some PGP/GPG public keys online, either posted on people’s web pages or on specialist key servers – e.g. <a href="https://pgp.mit.edu/">https://pgp.mit.edu/</a>. You should be able to find my public key there or you can <a href="archive/JimmyMcGibney_public_key.txt">copy it directly from here</a>. Import these into your GPG installation. Beware that there may be fake keys out there...</p>
</li>
</ul>

      </div>
     
      <div  class="ui tab segment lab" data-tab="4">
        <h2>3. Sharing encrypted files</h2>
<p><em>Note: When you encrypt a file to give to someone else, you do so with their public key. When you decrypt a file, you do so with your private key.</em></p>
<ul>
<li><p>Import (<em>File-&gt;Import...</em>) classmates’ public keys.</p>
</li>
<li><p>Create a number of files (e.g. text files), on the desktop for example. Selecting a file and clicking the right mouse button gives access to the <em>GpgEX</em> menu. This is a convenient way to encrypt or sign files. Select <em>Sign and Encrypt</em>. Check <em>Encrypt for others</em> and select your recipient. You may uncheck the other checkboxes on this dialogue.
<img src="img/kleopatra-encrypt.png" alt="Encrypt"></p>
</li>
<li><p>Send the encrypted file to your classmate. Find out if he/she can decrypt the file.</p>
</li>
<li><p>Also send your public key to a classmate. Try to decrypt a file that he/she sends to you (<em>More GpgEX options-&gt;Decrypt</em>).</p>
</li>
</ul>

      </div>
     
      <div  class="ui tab segment lab" data-tab="5">
        <h2>4. Authenticating files</h2>
<p><em>Note: When you verify someone else’s signed file, you do so with their public key. When you sign a file, you do so with your private key.</em></p>
<ul>
<li><p>Sign a file (right click and select Select <em>Sign and Encrypt</em>) and send the signature created to a classmate along with the original file that you have signed. You can uncheck the Encrypt checkboxes this time.
<img src="img/kleopatra-sign.png" alt="Encrypt"></p>
</li>
<li><p>For files received from others, verify origin (<em>More GpgEX options-&gt;Verify</em>). You need to have their public key to do this. </p>
</li>
</ul>

      </div>
     
      <div  class="ui tab segment lab" data-tab="6">
        <h2>5. Command-line GPG – <em>optional</em></h2>
<p><em>You may optionally skip this step if you have used a GPG or PGP GUI application and proceed to step 7.</em></p>
<p>Command-line GPG is included in many Linux distributions (e.g. Ubuntu) and versions for other operating systems can be downloaded from <a href="http://www.gnupg.org/download/">http://www.gnupg.org/download/</a>. The instructions below are based on command-line usage on Linux. </p>
<p>As with most Linux commands, you can get a full list of usage options by entering:</p>
<pre><code>man gpg</code></pre>
<p>or for more concise information, you can enter:</p>
<pre><code>gpg --help</code></pre>
<p>Verify which version of GPG you have with the command:</p>
<pre><code>gpg --version</code></pre>
<p>Use GPG to generate a key pair, import/export keys and carry out encryption and authentication – i.e. to do the same things as we did with PGP. There are numerous online tutorials with the steps required – <a href="http://bitflop.com/tutorials/gnupg-tutorial.html">this one is clear and concise</a></p>
<p>If you are using a virtual machine, it may be difficult for GPG to find sufficient random data to generate keys.  If gpg –-gen-key stalls due to a lack of random data, enter the following commands which get it to use the Linux built-in pseudorandom generator:</p>
<pre><code>   sudo apt-get install rng-tools
   sudo sh -c &#39;echo &quot;HRNGDEVICE=/dev/urandom&quot; &gt;&gt; /etc/default/rng-tools&#39;
   sudo /etc/init.d/rng-tools start</code></pre>
<p>Summary of main usage options:</p>
<pre><code>gpg --gen-key                           #create a key pair
gpg --import [File]                     #import someone’s public key from file
gpg --list-keys                         #show list of keys
gpg -e -r Recipient [File]              #encrypt file (giving it .gpg extension)
gpg -e --default-recipient-self [File]  #encrypt file to self
gpg -d [File]                           #decrypt
gpg -s [File]                           #sign
gpg --verify [File]                     #verify</code></pre>

      </div>
     
      <div  class="ui tab segment lab" data-tab="7">
        <h2>6. Upload to Moodle</h2>
<p>Create and upload to moodle a zip file called <em>GPG-yourfirstname-lastname.zip</em> to contain the following four files:</p>
<ul>
<li><p>(1) Your public key </p>
<ul>
<li>in ASCII-armored format (the default, with .asc extension). Name it <em>yourfirstname-lastname.asc</em><br><br></li>
</ul>
</li>
<li><p>(2) A text file, plus (3) associated signature file</p>
<ul>
<li>Create a text file containing a message for the lecturer with the following information:<ul>
<li>The program and the OS that are you using;</li>
<li>Your answer to the following exercise: Search for president@whitehouse.gov on a PGP key server (e.g. <a href="https://pgp.mit.edu"><a href="https://pgp.mit.edu">https://pgp.mit.edu</a></a>). Based on your findings, explain one useful feature and one drawback of PGP key servers.
Before signing, the file should be named <em>yourfirstname-lastname-answer.txt</em></li>
</ul>
</li>
<li>Sign it.<br><br></li>
</ul>
</li>
<li><p>(4) An encrypted file</p>
<ul>
<li>A file encrypted so that only I (J McGibney) can read it. Before encryption, this file should be named <em>yourfirstname-lastname-secret.txt</em>.  This file can contain any text at all.  You can find <a href="archive/JimmyMcGibney_public_key.txt">my public key here</a></li>
</ul>
</li>
</ul>

      </div>
     
      <div  class="ui tab segment lab" data-tab="8">
        <h2>7. Further Exploration</h2>
<p>Explore the PGP application further. Experiment with certifying other people’s keys. Also experiment with trusting others’ keys (by changing <em>Certification Trust</em> settings). </p>

      </div>
     
    </div>
  </div>
</div>
<!--<div class="ui bottom fixed borderless right menu">
  <div class="ui right tiny menu">
    <div class="ui mini message segment">
      .
      <a href="http://creativecommons.org/licenses/by-nc/4.0/"
         title="External link to http://creativecommons.org/licenses/by-nc/4.0/"
         target="_blank">Creative Commons License
      </a>
    </div>
  </div>
</div>-->

<script>
  $(document).on('keydown', function(e) {
  e = e || window.event;
  var nextTab;
  switch (e.which || e.keyCode) {
    case 37: // left
      nextTab = $('.tab-menu a[data-tab].active').prev('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').last();
      nextTab.click();
      $('.pusher').focus();
      break;

    case 39: // right
      nextTab = $('.tab-menu a[data-tab].active').next('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').first();
      nextTab.click();
      $('.pusher').focus();
      break;
  }
});

</script>



    <footer>

    </footer>
    <script>
      $(document).ready(function() {
  $('img').addClass('ui image');

  $('.ui.embed').embed();

  const $images = $('.lab img');
  jQuery.each($images, function(i) {
    if ($images[i].alt.length > 0) {
      const divImg = $(document.createElement('div')).addClass(
        'ui basic segment',
      );
      $($images[i]).wrap(divImg);
      const divLabel = $(document.createElement('div')).addClass(
        'ui blue ribbon label',
      );
      divLabel.append($images[i].alt);
      $(divLabel).insertBefore($images[i]);
    }
  });

  $('.ui.menu .item').tab({
    history: true,
    historyType: 'hash',
  });

  $('.popup').popup();

  $('.ui.sidebar')
    .sidebar({ context: $('.pushable') })
    .sidebar('setting', 'transition', 'slide out')
    .sidebar('attach events', '#toc');
});

    </script>
  </body>

 </html>