 <!DOCTYPE html>
 <html>
   <head>

     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1">

     

     <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>

     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.css" type="text/css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-light.min.css" rel="stylesheet" />

     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.address/1.6/jquery.address.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/java.min.js"></script>
     <script>hljs.initHighlightingOnLoad();</script>

     

     <style>
       

body 
{
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
}

figcaption
{
  margin-bottom: 20px;
}

.vertical-align
{
  display: flex;
  align-items: center;
}

.ui.segment.pushable
{
  margin: 0;
  padding: 1rem 0;
  overflow: visible;
}



     </style>

   </head>

  <body>
    

<style>
  

code
{
  font-family: "Monaco";
  font-size: 110%;
}

img
{
  padding:1px;
  border:1px solid black;
}

h1
{
  font-style:italic;
  font-size:130%;
  border-bottom:thin solid black;
}

h2
{
  font-size:110%;
  border-bottom: thin solid black;
}

h3
{
  font-size:100%;
  border-bottom: thin solid black;
}

body
{
  overflow-y: scroll;
}

.pushable > .pusher
{
  padding-bottom: 1.5rem;
}

.ui.segment.pushable
{
  margin: 0;
  padding: 1rem 0;
  overflow: visible;
}



</style>

<div class="ui fixed top pointing inverted stackable menu labmenu">
  <header class="header item">
    <i id="toc" class="sitemap icon"></i>
    <a href="../index.html">
      23: Aurelia View Models
    </a>
  </header>
  <div class="right tab-menu menu">
    
    <a class="item" data-tab="Lab-Aurelia 2">
      Lab-Aurelia 2
    </a>
    
    <a class="item" data-tab="Exercise Solutions">
      Exercise Solutions
    </a>
    
    <a class="item" data-tab="02">
      02
    </a>
    
    <a class="item" data-tab="03">
      03
    </a>
    
    <a class="item" data-tab="04">
      04
    </a>
    
    <a class="item" data-tab="05">
      05
    </a>
    
    <a class="item" data-tab="06">
      06
    </a>
    
    <a class="item" data-tab="07.Exercises">
      07.Exercises
    </a>
    
    <div class="item">
      
    </div>
  </div>
</div>

<div class="ui segment pushable">
  <div class="ui inverted labeled icon left inline vertical sidebar menu">
    <br><br>
    
      
        <a class="item" href="../../topic-02-js-review/book-1-javascript-intro/index.html">
          Lab-2.1 JS Intro
        </a>
      
    
      
        <a class="item" href="../../topic-02-js-review/book-2-javascript-fundamentals/index.html">
          Lab-2.2 JS Basics
        </a>
      
    
      
        <a class="item" href="../../topic-03-jquery+dom/book-3-jquery/index.html">
          Lab-3 JQuery
        </a>
      
    
      
        <a class="item" href="../../topic-04-ajax+apis/book-1-ajax-1/index.html">
          Lab-4.1 Github API
        </a>
      
    
      
        <a class="item" href="../../topic-04-ajax+apis/book-2-ajax-2/index.html">
          Lab-4.2-FoureSquare API
        </a>
      
    
      
        <a class="item" href="../../topic-05-applications/book-applications/index.html">
          Lab-5 Applications
        </a>
      
    
      
        <a class="item" href="../../topic-06-views/book-views/index.html">
          Lab-6 Views
        </a>
      
    
      
        <a class="item" href="../../topic-07-sessions/book-sessions/index.html">
          Lab-7 Sessions
        </a>
      
    
      
        <a class="item" href="../../topic-08-models/book-models/index.html">
          Lab-8 Models
        </a>
      
    
      
        <a class="item" href="../../topic-09-validation/book-validation/index.html">
          Lab-9 Validation
        </a>
      
    
      
        <a class="item" href="../../topic-10-deployment/book-deployment/index.html">
          Lab-10 Deployment
        </a>
      
    
      
        <a class="item" href="../../topic-11-seeding/book-seeding/index.html">
          Lab-11 Seeding
        </a>
      
    
      
        <a class="item" href="../../topic-12-api/book-api/index.html">
          Lab-12 Apis
        </a>
      
    
      
        <a class="item" href="../../topic-13-security-introduction/book-1-pgp-gpg/index.html">
          Lab-13 GPG
        </a>
      
    
      
        <a class="item" href="../../topic-14-security-foundations/book-1-openssl/index.html">
          Lab-14 OpenSSL and Certificates
        </a>
      
    
      
        <a class="item" href="../../topic-15-authentication+tls/book-1-tls-configuration/index.html">
          Lab-15 TLS Configuration
        </a>
      
    
      
        <a class="item" href="../../topic-16-tdd/book-tdd/index.html">
          Lab-16 Tdd
        </a>
      
    
      
        <a class="item" href="../../topic-17-webapp-threats+vulnerabilities/book-1-misuse-cases/index.html">
          Lab-17 Misuse Cases
        </a>
      
    
      
        <a class="item" href="../../topic-18-rest/book-rest/index.html">
          Lab-18 Rest
        </a>
      
    
      
        <a class="item" href="../../topic-19-web-app-authentication/book-1-web-authentication/index.html">
          Lab-19 Authentication techniques
        </a>
      
    
      
        <a class="item" href="../../topic-20-rest-client/book-rest-client/index.html">
          Lab-19 Java Rest Client
        </a>
      
    
      
        <a class="item" href="../../topic-21-aurelia-1/book-aurelia-1/index.html">
          Lab-Aurelia 1
        </a>
      
    
      
        <a class="item" href="../../topic-22-pentesting/book-1-burp-proxy/index.html">
          Lab-Burp-Proxy
        </a>
      
    
      
        <a class="item" href="../../topic-22-pentesting/book-2-regex/index.html">
          Regular Expressions
        </a>
      
    
      
        <a class="item" href="../../topic-22-pentesting/book-3-xss/index.html">
          XSS tips
        </a>
      
    
      
        <a class="active item" href="../../topic-23-aurelia-2/book-aurelia-2/index.html">
          Lab-Aurelia 2
        </a>
      
    
      
        <a class="item" href="../../topic-24-aurelia-3/book-aurelia-3/index.html">
          Lab-Aurelia 3
        </a>
      
    
  </div>
  <div class="pusher" tabindex="-1">
    <div class="ui basic segment" id="labchat">
      <br>
      
      <div  class="ui tab segment lab" data-tab="Lab-Aurelia 2">
        <h1>Objectives</h1>
<p>Continue evolving the donation-client with login/logout feature + a mechanism for selecting revealing the various view/models.</p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="Exercise Solutions">
        <h1>Lab Aurelia 1 Exercise Solutions</h1>
<p>This is a new method in the <code>DonationService</code> class, which will add a new candidate:</p>
<h2>src/services/donation-service.js</h2>
<pre><code>  addCandidate(firstName, lastName, office) {
    const candidate = {
      firstName: firstName,
      lastName: lastName,
      office: office
    };
    this.candidates.push(candidate);
  }</code></pre>
<p>.. and this is the implementation of the <code>Candidates</code> viewmodel class to accompany the <code>candidates.html</code> template:</p>
<h2>src/viewmodels/candidates.js</h2>
<pre><code>import {inject} from &#39;aurelia-framework&#39;;
import DonationService from &#39;../services/donation-service&#39;;

@inject(DonationService)
export class Candidate {

  firstName = &#39;&#39;;
  lastName = &#39;&#39;;
  office = &#39;&#39;;

  constructor(ds) {
    this.donationService = ds;
  }

  addCandidate() {
    this.donationService.addCandidate(this.firstName, this.lastName, this.office);
  }
}</code></pre>
<p>Now we can include this viewmodel in <code>app.html</code>:</p>
<h2>src/app.html</h2>
<pre><code>&lt;template&gt;

  &lt;div class=&quot;ui container&quot;&gt;
    &lt;section class=&quot;ui three column stackable grid basic segment&quot;&gt;
      &lt;div class=&quot;ui row&quot;&gt;
        &lt;aside class=&quot;column&quot;&gt;
          &lt;compose view-model=&quot;./viewmodels/donate&quot;&gt;&lt;/compose&gt;
        &lt;/aside&gt;
        &lt;article class=&quot;column&quot;&gt;
          &lt;compose view-model=&quot;./viewmodels/report&quot;&gt;&lt;/compose&gt;
        &lt;/article&gt;
        &lt;article class=&quot;column&quot;&gt;
          &lt;compose view-model=&quot;./viewmodels/candidates&quot;&gt;&lt;/compose
        &lt;/article&gt;
      &lt;/div&gt;
    &lt;/section&gt;
  &lt;/div&gt;

&lt;/template&gt;</code></pre>
<p>This should render as shown:</p>
<p><img src="img/01.png" alt=""></p>
<p>Our existing data binding strategies should ensure that entering a new candidate should nicely propagate to the donate viewmodel.</p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="02">
        <h1>Stats Viewmodel</h1>
<p>We would like to display the total amount donated so far. To prepare for this, we can extend donation-service to track and accumulate this as a <code>total</code> attribute:</p>
<h2>src/donation-service.js</h2>
<pre><code>export default class DonationService {
  ...
  ...
  total = 0;
  ...
  ...
  donate(amount, method, candidate) {
    ...
    ...

    this.total = this.total + parseInt(amount, 10);
    console.log(&#39;Total so far &#39; + this.total);
  }

  ...
  ...   
}</code></pre>
<p>Include the above now and make sure the total are appearing in the (browser) console.</p>
<p>Here is our first attempt at a component to display the total:</p>
<h2>src/viewmodels/stats.html</h2>
<pre><code>&lt;template&gt;

  &lt;section class=&quot;ui stacked statistic segment&quot;&gt;
    &lt;div class=&quot;value&quot;&gt;
      ${total}
    &lt;/div&gt;
    &lt;div class=&quot;label&quot;&gt;
      Donated
    &lt;/div&gt;
  &lt;/section&gt;

&lt;/template&gt;</code></pre>
<h2>src/viewmodels/stats.js</h2>
<pre><code>import {inject} from &#39;aurelia-framework&#39;;
import DonationService from &#39;../services/donation-service&#39;;

@inject(DonationService)
export class Stats {

  total = 0;

  constructor(ds) {
    this.donationService = ds;
    this.total = ds.total;
  }
}</code></pre>
<p>We can include it in our main view:</p>
<h2>src/app.html</h2>
<pre><code>&lt;template&gt;

  &lt;div class=&quot;ui container&quot;&gt;
    &lt;section class=&quot;ui four column stackable grid basic segment&quot;&gt;
      &lt;div class=&quot;ui row&quot;&gt;
        &lt;aside class=&quot;column&quot;&gt;
          &lt;compose view-model=&quot;./viewmodels/donate&quot;&gt;&lt;/compose&gt;
        &lt;/aside&gt;
        &lt;article class=&quot;column&quot;&gt;
          &lt;compose view-model=&quot;./viewmodels/report&quot;&gt;&lt;/compose&gt;
        &lt;/article&gt;
        &lt;article class=&quot;column&quot;&gt;
          &lt;compose view-model=&quot;./viewmodels/candidates&quot;&gt;&lt;/compose&gt;
        &lt;/article&gt;
        &lt;article class=&quot;column&quot;&gt;
          &lt;compose view-model=&quot;./viewmodels/stats&quot;&gt;&lt;/compose&gt;
        &lt;/article&gt;
      &lt;/div&gt;
    &lt;/section&gt;
  &lt;/div&gt;

&lt;/template&gt;</code></pre>
<p>This should render like this:</p>
<p><img src="img/02.png" alt=""></p>
<p>Try making donations now - you will notice that our stat view is not updating! Can you explain why?</p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="03">
        <h1>Events</h1>
<p>We have been able to hook up the candidate array directly to the donation-service candidate list - and these have stayed in sync. However, the total maintained in the stats viewmodel is not performing in a similiar manner. This is because this is a separate value object (a number) and not a reference to an array.</p>
<p>Fixing this gives us an opportunity to explore events in Aurelia, which are an elegant and simple mechanism for communicating in a clean way between components.</p>
<p>First, in the services folder, introduce a new <code>messages</code> file:</p>
<h2>src/services/messages.js</h2>
<pre><code>export class TotalUpdate {
  constructor(total) {
    this.total = total;
  }
}</code></pre>
<p>This defines a message of interest - namely an update to the total donations received.</p>
<p>In <code>DonationService</code> import this class + the event aggregator we need to dispatch the events:</p>
<h2>src/services/donation-service.js</h2>
<pre><code>...
import {TotalUpdate} from &#39;./messages&#39;;
import {EventAggregator} from &#39;aurelia-event-aggregator&#39;;
...</code></pre>
<p>The constructor in <code>DonationService</code> needs to initialise store the aggregator:</p>
<pre><code>@inject(Fixtures, EventAggregator)
export default class DonationService {
  ...
  ...
  constructor(data, ea) {
    ...
    ...
    this.ea = ea;
  }</code></pre>
<p>and finally (for DonationService), we need to generate the event when a total is updated:</p>
<pre><code>  donate(amount, method, candidate) {
    ...
    ...

    this.total = this.total + parseInt(amount, 10);
    console.log(&#39;Total so far &#39; + this.total);
    this.ea.publish(new TotalUpdate(this.total));
  }</code></pre>
<p>This is the revised stats view model:</p>
<h2>src/viewmodels/stats.js</h2>
<pre><code>import {inject} from &#39;aurelia-framework&#39;;
import {TotalUpdate} from &#39;../services/messages&#39;;
import {EventAggregator} from &#39;aurelia-event-aggregator&#39;;

@inject(EventAggregator)
export class Stats {

  total = 0;

  constructor(ea) {
    ea.subscribe(TotalUpdate, msg =&gt; {
      this.total = msg.total;
    });
  }
}</code></pre>
<p>It has been simplified (removed reference to donation-service), and hooked up to the event aggregator. It listens for <code>TotalUpdate</code> events, and stores them in <code>total</code> attribute. This is automatically rendered in the view. </p>
<p>Try this now and verify it works as expected.</p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="04">
        <h1>Login</h1>
<p>We might like to have a user log in before we allow donations etc.. Bring in this template:</p>
<h2>src/viewmodels/login.html</h2>
<pre><code>&lt;template&gt;

  &lt;form submit.delegate=&quot;login($event)&quot; class=&quot;ui stacked segment form&quot;&gt;
    &lt;h3 class=&quot;ui header&quot;&gt;Log-in&lt;/h3&gt;
    &lt;div class=&quot;field&quot;&gt;
      &lt;label&gt;Email&lt;/label&gt; &lt;input placeholder=&quot;Email&quot; value.bind=&quot;email&quot;/&gt;
    &lt;/div&gt;
    &lt;div class=&quot;field&quot;&gt;
      &lt;label&gt;Password&lt;/label&gt; &lt;input type=&quot;password&quot; value.bind=&quot;password&quot;/&gt;
    &lt;/div&gt;
    &lt;button class=&quot;ui blue submit button&quot;&gt;Login&lt;/button&gt;
    &lt;h3&gt;${prompt}&lt;/h3&gt;
  &lt;/form&gt;

&lt;/template&gt;</code></pre>
<p>Note that we are not using a viewmodel class with this template. We can bring in this &#39;viewmodelless&#39; view into <code>app.html</code>:</p>
<h2>src/app.html</h2>
<pre><code>&lt;template&gt;

  &lt;div class=&quot;ui container&quot;&gt;
    &lt;section class=&quot;ui four column stackable grid basic segment&quot;&gt;
      &lt;div class=&quot;ui row&quot;&gt;
        &lt;section class=&quot;ui five wide column&quot;&gt;
          &lt;compose view=&quot;./viewmodels/login.html&quot;&gt;&lt;/compose&gt;
        &lt;/section&gt;
      &lt;/div&gt;
      &lt;div class=&quot;ui row&quot;&gt;
        &lt;aside class=&quot;column&quot;&gt;
          &lt;compose view-model=&quot;./viewmodels/donate&quot;&gt;&lt;/compose&gt;
        &lt;/aside&gt;
        &lt;article class=&quot;column&quot;&gt;
          &lt;compose view-model=&quot;./viewmodels/report&quot;&gt;&lt;/compose&gt;
        &lt;/article&gt;
        &lt;article class=&quot;column&quot;&gt;
          &lt;compose view-model=&quot;./viewmodels/candidates&quot;&gt;&lt;/compose&gt;
        &lt;/article&gt;
        &lt;article class=&quot;column&quot;&gt;
          &lt;compose view-model=&quot;./viewmodels/stats&quot;&gt;&lt;/compose&gt;
        &lt;/article&gt;
      &lt;/div&gt;
    &lt;/section&gt;
  &lt;/div&gt;

&lt;/template&gt;</code></pre>
<p>Look at how we have composed the login view:</p>
<pre><code>        &lt;section class=&quot;ui five wide column&quot;&gt;
          &lt;compose view=&quot;./viewmodels/login.html&quot;&gt;&lt;/compose&gt;
        &lt;/section&gt;</code></pre>
<p>..we have used <code>view=</code> instead of <code>view-model=</code>.</p>
<p>Now we can bind this view&#39;s login fields directly to <code>app.js</code>:</p>
<h2>src/app.js</h2>
<pre><code>export class App {

  email = &#39;marge@simpson.com&#39;;
  password = &#39;secret&#39;;

  loggedIn = false;

  login() {
    console.log(`Logging in ${this.email}`);
    this.loggedIn = true;
  }
}</code></pre>
<p>Refreshing the browser:</p>
<p><img src="img/03.png" alt=""></p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="05">
        <h1>Selectively Revealing the Views</h1>
<p>We should only reveal the donation / report / stats view is the user is logged in. Also, when the user is logged in we should hide the login view.</p>
<p>We already have the boolean value defined in <code>App</code>:</p>
<pre><code>  loggedIn = false;</code></pre>
<p>Using this, we can introduce a clause in the view to reveal the appropriate components:</p>
<h2>src/app.html</h2>
<pre><code>&lt;template&gt;

  &lt;div class=&quot;ui container&quot;&gt;
    &lt;section class=&quot;ui four column stackable grid basic segment&quot;&gt;
      &lt;div show.bind=&quot;!loggedIn&quot; class=&quot;ui row&quot;&gt;
        &lt;section class=&quot;ui five wide column&quot;&gt;
          &lt;compose view=&quot;./viewmodels/login.html&quot;&gt;&lt;/compose&gt;
        &lt;/section&gt;
      &lt;/div&gt;
      &lt;div show.bind=&quot;loggedIn&quot; class=&quot;ui row&quot;&gt;
        &lt;aside class=&quot;column&quot;&gt;
          &lt;compose view-model=&quot;./viewmodels/donate&quot;&gt;&lt;/compose&gt;
        &lt;/aside&gt;
        &lt;article class=&quot;column&quot;&gt;
          &lt;compose view-model=&quot;./viewmodels/report&quot;&gt;&lt;/compose&gt;
        &lt;/article&gt;
        &lt;article class=&quot;column&quot;&gt;
          &lt;compose view-model=&quot;./viewmodels/candidates&quot;&gt;&lt;/compose&gt;
        &lt;/article&gt;
        &lt;article class=&quot;column&quot;&gt;
          &lt;compose view-model=&quot;./viewmodels/stats&quot;&gt;&lt;/compose&gt;
        &lt;/article&gt;
      &lt;/div&gt;
    &lt;/section&gt;
  &lt;/div&gt;

&lt;/template&gt;</code></pre>
<p>The binding behaviour to achieve this is in here:</p>
<pre><code>      &lt;div show.bind=&quot;!loggedIn&quot; class=&quot;ui row&quot;&gt;
        ...
      &lt;/div&gt;
      &lt;div show.bind=&quot;loggedIn&quot; class=&quot;ui row&quot;&gt;
        ...
      &lt;/div&gt;</code></pre>
<p>This effectively toggles the two rows, depending on the value of <code>loggedIn</code> in app. Once logged in, though, we dont seem to have a way of logging out.</p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="06">
        <h1>Logout Support</h1>
<p>To support login/logout in a more structured manner, modify <code>app.html</code> to include a menubar:</p>
<h2>src/app.html</h2>
<pre><code>&lt;template&gt;

  &lt;div class=&quot;ui container&quot;&gt;

    &lt;nav class=&quot;ui inverted menu&quot;&gt;
      &lt;header class=&quot;header item&quot;&gt;&lt;a href=&quot;/&quot;&gt; Donation &lt;/a&gt;&lt;/header&gt;
      &lt;div class=&quot;right menu&quot;&gt;
        &lt;div show.bind=&quot;loggedIn&quot;&gt;
          &lt;a id=&quot;logout&quot; class= &quot;item&quot; click.trigger=&quot;logout()&quot;&gt; Logout&lt;/a&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/nav&gt;

   ...
   ...</code></pre>
<p>This menubar displays a logout button - but only if the state of the viewmodel is <code>loggedIn</code>. To support the logout button, implement the event handler in the <code>app</code> class:</p>
<h2>src/app.js</h2>
<pre><code>  logout() {
    console.log(&#39;Logging out`&#39;);
    this.loggedIn = false;
  }</code></pre>
<p>Although we are not using any validation, the UX should now support a facsimile of login/logout behaviour.</p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="07.Exercises">
        <h1>Exercises</h1>
<p>Archive of the lab so far:</p>
<ul>
<li><a href="https://bitbucket.org/edeleastar/donation-client/commits/tag/aurelia.2.end">https://bitbucket.org/edeleastar/donation-client/commits/tag/aurelia.2.end</a></li>
</ul>
<h2>Exercise 1: Login Feature in DonationService</h2>
<p>Implement in <code>DonationService</code> a login feature, which checks the username/password against the fixtures we have already loaded in this class. Only allow the user to progress to logged in status if there is a valid entry</p>
<h2>Exercise 2: Signup UI + Feature</h2>
<p>Implement a signup viewmodel, which will add a user to the <code>DonationService</code> users array. This view should be visible when the user presses a &#39;signup&#39; option on the menu. This will take some work, as we want either the login view OR the signup view to appear. Subsequently, once logged in, we wish neither view to be visible.</p>

      </div>
     
    </div>
  </div>
</div>
<!--<div class="ui bottom fixed borderless right menu">
  <div class="ui right tiny menu">
    <div class="ui mini message segment">
      .
      <a href="http://creativecommons.org/licenses/by-nc/4.0/"
         title="External link to http://creativecommons.org/licenses/by-nc/4.0/"
         target="_blank">Creative Commons License
      </a>
    </div>
  </div>
</div>-->

<script>
  $(document).on('keydown', function(e) {
  e = e || window.event;
  var nextTab;
  switch (e.which || e.keyCode) {
    case 37: // left
      nextTab = $('.tab-menu a[data-tab].active').prev('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').last();
      nextTab.click();
      $('.pusher').focus();
      break;

    case 39: // right
      nextTab = $('.tab-menu a[data-tab].active').next('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').first();
      nextTab.click();
      $('.pusher').focus();
      break;
  }
});

</script>



    <footer>

    </footer>
    <script>
      $(document).ready(function() {
  $('img').addClass('ui image');

  $('.ui.embed').embed();

  const $images = $('.lab img');
  jQuery.each($images, function(i) {
    if ($images[i].alt.length > 0) {
      const divImg = $(document.createElement('div')).addClass(
        'ui basic segment',
      );
      $($images[i]).wrap(divImg);
      const divLabel = $(document.createElement('div')).addClass(
        'ui blue ribbon label',
      );
      divLabel.append($images[i].alt);
      $(divLabel).insertBefore($images[i]);
    }
  });

  $('.ui.menu .item').tab({
    history: true,
    historyType: 'hash',
  });

  $('.popup').popup();

  $('.ui.sidebar')
    .sidebar({ context: $('.pushable') })
    .sidebar('setting', 'transition', 'slide out')
    .sidebar('attach events', '#toc');
});

    </script>
  </body>

 </html>